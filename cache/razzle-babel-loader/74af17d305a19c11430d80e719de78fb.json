{"ast":null,"code":"var _s = $RefreshSig$();\n\nimport React from 'react';\nimport Undoo from 'undoo'; // Code based on Apache-2.0 License\n// https://github.com/reaviz/reaflow/blob/78d60aa04f514947a17097c906efdbbd6bae5080/src/helpers/useUndo.ts\n\nconst useUndoManager = (state, onUndoRedo, _ref) => {\n  _s();\n\n  let {\n    maxUndoLevels,\n    enableHotKeys = true\n  } = _ref;\n  const [canUndo, setCanUndo] = React.useState(false);\n  const [canRedo, setCanRedo] = React.useState(false);\n  const manager = React.useRef(new Undoo({\n    maxLength: maxUndoLevels\n  })); // Reference:\n  // https://reactjs.org/docs/hooks-faq.html#how-to-read-an-often-changing-value-from-usecallback\n\n  const callbackRef = React.useRef(onUndoRedo);\n  React.useEffect(() => {\n    callbackRef.current = onUndoRedo;\n  }, [onUndoRedo]);\n  const doUndo = React.useCallback(() => {\n    manager.current.undo(_ref2 => {\n      let {\n        state\n      } = _ref2;\n      const nextUndo = manager.current.canUndo();\n      const nextRedo = manager.current.canRedo();\n      setCanUndo(nextUndo);\n      setCanRedo(nextRedo);\n      callbackRef.current({\n        state,\n        type: 'undo',\n        canUndo: nextUndo,\n        canRedo: nextRedo\n      });\n    });\n  }, []);\n  React.useEffect(() => {\n    manager.current.save({\n      state\n    });\n    setCanUndo(manager.current.canUndo());\n    setCanRedo(manager.current.canRedo());\n  }, [state]);\n  const doRedo = React.useCallback(() => {\n    manager.current.redo(_ref3 => {\n      let {\n        state\n      } = _ref3;\n      const nextUndo = manager.current.canUndo();\n      const nextRedo = manager.current.canRedo();\n      setCanUndo(nextUndo);\n      setCanRedo(nextRedo);\n      callbackRef.current({\n        state,\n        type: 'redo',\n        canUndo: nextUndo,\n        canRedo: nextRedo\n      });\n    });\n  }, []);\n  const handleKeys = React.useCallback(event => {\n    const keyName = event.key;\n\n    if (keyName === 'Control' || keyName === 'Meta') {\n      // do not alert when only Control key is pressed.\n      return;\n    }\n\n    if (event.ctrlKey || event.metaKey) {\n      if (keyName === 'z') {\n        event.preventDefault();\n        event.stopPropagation();\n        doUndo();\n      } else if (keyName === 'y') {\n        event.preventDefault();\n        event.stopPropagation();\n        doRedo();\n      }\n    } else {\n      return;\n    }\n  }, [doUndo, doRedo]);\n  React.useEffect(() => {\n    if (!enableHotKeys) return;\n    document.addEventListener('keydown', handleKeys);\n    return () => document.removeEventListener('keydown', handleKeys);\n  }, [enableHotKeys, handleKeys]);\n  return {\n    doUndo,\n    doRedo,\n    canUndo,\n    canRedo\n  };\n};\n\n_s(useUndoManager, \"nMLJoehySXEtKQq/ERiLyJvMSZQ=\");\n\nexport default useUndoManager;","map":{"version":3,"names":["React","Undoo","useUndoManager","state","onUndoRedo","maxUndoLevels","enableHotKeys","canUndo","setCanUndo","useState","canRedo","setCanRedo","manager","useRef","maxLength","callbackRef","useEffect","current","doUndo","useCallback","undo","nextUndo","nextRedo","type","save","doRedo","redo","handleKeys","event","keyName","key","ctrlKey","metaKey","preventDefault","stopPropagation","document","addEventListener","removeEventListener"],"sources":["/home/jakob/workspace/training-project/node_modules/@plone/volto/src/helpers/UndoManager/useUndoManager.js"],"sourcesContent":["import React from 'react';\nimport Undoo from 'undoo';\n\n// Code based on Apache-2.0 License\n// https://github.com/reaviz/reaflow/blob/78d60aa04f514947a17097c906efdbbd6bae5080/src/helpers/useUndo.ts\n\nconst useUndoManager = (\n  state,\n  onUndoRedo,\n  { maxUndoLevels, enableHotKeys = true },\n) => {\n  const [canUndo, setCanUndo] = React.useState(false);\n  const [canRedo, setCanRedo] = React.useState(false);\n  const manager = React.useRef(new Undoo({ maxLength: maxUndoLevels }));\n  // Reference:\n  // https://reactjs.org/docs/hooks-faq.html#how-to-read-an-often-changing-value-from-usecallback\n  const callbackRef = React.useRef(onUndoRedo);\n  React.useEffect(() => {\n    callbackRef.current = onUndoRedo;\n  }, [onUndoRedo]);\n\n  const doUndo = React.useCallback(() => {\n    manager.current.undo(({ state }) => {\n      const nextUndo = manager.current.canUndo();\n      const nextRedo = manager.current.canRedo();\n      setCanUndo(nextUndo);\n      setCanRedo(nextRedo);\n\n      callbackRef.current({\n        state,\n        type: 'undo',\n        canUndo: nextUndo,\n        canRedo: nextRedo,\n      });\n    });\n  }, []);\n\n  React.useEffect(() => {\n    manager.current.save({\n      state,\n    });\n\n    setCanUndo(manager.current.canUndo());\n    setCanRedo(manager.current.canRedo());\n  }, [state]);\n\n  const doRedo = React.useCallback(() => {\n    manager.current.redo(({ state }) => {\n      const nextUndo = manager.current.canUndo();\n      const nextRedo = manager.current.canRedo();\n      setCanUndo(nextUndo);\n      setCanRedo(nextRedo);\n\n      callbackRef.current({\n        state,\n        type: 'redo',\n        canUndo: nextUndo,\n        canRedo: nextRedo,\n      });\n    });\n  }, []);\n\n  const handleKeys = React.useCallback(\n    (event) => {\n      const keyName = event.key;\n\n      if (keyName === 'Control' || keyName === 'Meta') {\n        // do not alert when only Control key is pressed.\n        return;\n      }\n      if (event.ctrlKey || event.metaKey) {\n        if (keyName === 'z') {\n          event.preventDefault();\n          event.stopPropagation();\n          doUndo();\n        } else if (keyName === 'y') {\n          event.preventDefault();\n          event.stopPropagation();\n          doRedo();\n        }\n      } else {\n        return;\n      }\n    },\n    [doUndo, doRedo],\n  );\n\n  React.useEffect(() => {\n    if (!enableHotKeys) return;\n    document.addEventListener('keydown', handleKeys);\n    return () => document.removeEventListener('keydown', handleKeys);\n  }, [enableHotKeys, handleKeys]);\n\n  return {\n    doUndo,\n    doRedo,\n    canUndo,\n    canRedo,\n  };\n};\n\nexport default useUndoManager;\n"],"mappings":"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"},"metadata":{"react-intl":{"messages":[]}},"sourceType":"module"}