{"ast":null,"code":"import express from 'express';\nimport { getAPIResourceWithAuth } from '@plone/volto/helpers';\nconst HEADERS = ['Accept-Ranges', 'Cache-Control', 'Content-Disposition', 'Content-Range', 'Content-Type'];\n\nfunction fileMiddleware(req, res, next) {\n  getAPIResourceWithAuth(req).then(resource => {\n    // Just forward the headers that we need\n    HEADERS.forEach(header => {\n      if (resource.get(header)) {\n        res.set(header, resource.get(header));\n      }\n    });\n    res.status(resource.statusCode);\n    res.send(resource.body);\n  }).catch(next);\n}\n\nexport default function () {\n  const middleware = express.Router();\n  middleware.all(['**/@@download/*', '**/@@display-file/*'], fileMiddleware);\n  middleware.id = 'filesResourcesProcessor';\n  return middleware;\n}","map":{"version":3,"names":["express","getAPIResourceWithAuth","HEADERS","fileMiddleware","req","res","next","then","resource","forEach","header","get","set","status","statusCode","send","body","catch","middleware","Router","all","id"],"sources":["/home/jakob/workspace/training-project/node_modules/@plone/volto/src/express-middleware/files.js"],"sourcesContent":["import express from 'express';\nimport { getAPIResourceWithAuth } from '@plone/volto/helpers';\n\nconst HEADERS = [\n  'Accept-Ranges',\n  'Cache-Control',\n  'Content-Disposition',\n  'Content-Range',\n  'Content-Type',\n];\n\nfunction fileMiddleware(req, res, next) {\n  getAPIResourceWithAuth(req)\n    .then((resource) => {\n      // Just forward the headers that we need\n      HEADERS.forEach((header) => {\n        if (resource.get(header)) {\n          res.set(header, resource.get(header));\n        }\n      });\n      res.status(resource.statusCode);\n      res.send(resource.body);\n    })\n    .catch(next);\n}\n\nexport default function () {\n  const middleware = express.Router();\n\n  middleware.all(['**/@@download/*', '**/@@display-file/*'], fileMiddleware);\n  middleware.id = 'filesResourcesProcessor';\n  return middleware;\n}\n"],"mappings":"AAAA,OAAOA,OAAP,MAAoB,SAApB;AACA,SAASC,sBAAT,QAAuC,sBAAvC;AAEA,MAAMC,OAAO,GAAG,CACd,eADc,EAEd,eAFc,EAGd,qBAHc,EAId,eAJc,EAKd,cALc,CAAhB;;AAQA,SAASC,cAAT,CAAwBC,GAAxB,EAA6BC,GAA7B,EAAkCC,IAAlC,EAAwC;EACtCL,sBAAsB,CAACG,GAAD,CAAtB,CACGG,IADH,CACSC,QAAD,IAAc;IAClB;IACAN,OAAO,CAACO,OAAR,CAAiBC,MAAD,IAAY;MAC1B,IAAIF,QAAQ,CAACG,GAAT,CAAaD,MAAb,CAAJ,EAA0B;QACxBL,GAAG,CAACO,GAAJ,CAAQF,MAAR,EAAgBF,QAAQ,CAACG,GAAT,CAAaD,MAAb,CAAhB;MACD;IACF,CAJD;IAKAL,GAAG,CAACQ,MAAJ,CAAWL,QAAQ,CAACM,UAApB;IACAT,GAAG,CAACU,IAAJ,CAASP,QAAQ,CAACQ,IAAlB;EACD,CAVH,EAWGC,KAXH,CAWSX,IAXT;AAYD;;AAED,eAAe,YAAY;EACzB,MAAMY,UAAU,GAAGlB,OAAO,CAACmB,MAAR,EAAnB;EAEAD,UAAU,CAACE,GAAX,CAAe,CAAC,iBAAD,EAAoB,qBAApB,CAAf,EAA2DjB,cAA3D;EACAe,UAAU,CAACG,EAAX,GAAgB,yBAAhB;EACA,OAAOH,UAAP;AACD"},"metadata":{"react-intl":{"messages":[]}},"sourceType":"module"}