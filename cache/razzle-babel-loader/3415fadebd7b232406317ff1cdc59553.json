{"ast":null,"code":"var _jsxFileName = \"/home/jakob/workspace/training-project/node_modules/@plone/volto/packages/volto-slate/src/editor/ui/Toolbar.jsx\";\nvar __jsx = React.createElement;\nimport React, { useRef, useEffect } from 'react';\nimport { Portal } from 'react-portal';\nimport { useSlate } from 'slate-react';\nimport Separator from './Separator';\nimport BasicToolbar from './BasicToolbar';\nimport { Editor } from 'slate';\nimport { ReactEditor } from 'slate-react';\n\nconst Toolbar = ({\n  elementType,\n  enableExpando = false,\n  toggleButton,\n  className,\n  children,\n  show = true\n}) => {\n  const ref = useRef();\n  const editor = useSlate();\n  useEffect(() => {\n    const el = ref.current;\n\n    if ((children || []).length === 0) {\n      el.removeAttribute('style');\n      return;\n    }\n\n    if (!show) {\n      el.removeAttribute('style');\n      return;\n    }\n\n    const {\n      selection\n    } = editor; // const savedSelection = editor.getSavedSelection();\n\n    if (!selection) {\n      el.removeAttribute('style');\n      return;\n    }\n\n    if (editor.isSidebarOpen) {\n      el.removeAttribute('style');\n      return;\n    }\n\n    let rect;\n\n    if (elementType) {\n      const [element] = Editor.nodes(editor, {\n        at: editor.selection || editor.getSavedSelection(),\n        match: n => n.type === elementType\n      });\n\n      if (!element) {\n        el.removeAttribute('style');\n        return;\n      }\n\n      const [n] = element;\n      const domEl = ReactEditor.toDOMNode(editor, n);\n      rect = domEl.getBoundingClientRect();\n    } else {\n      const domSelection = window.getSelection();\n\n      if (domSelection.rangeCount < 1) {\n        // don't do anything here, this happens when opening a focus-stealing\n        // component, in which case we actually want to keep the toolbar open\n        // See\n        // https://stackoverflow.com/questions/22935320/uncaught-indexsizeerror-failed-to-execute-getrangeat-on-selection-0-is-not\n        return;\n      }\n\n      const domRange = domSelection.getRangeAt(0);\n      rect = domRange.getBoundingClientRect();\n    }\n\n    el.style.opacity = 1;\n    el.style.top = `${rect.top + window.pageYOffset - el.offsetHeight - 6}px`;\n    el.style.left = `${Math.max(rect.left + window.pageXOffset - el.offsetWidth / 2 + rect.width / 2, 0 // if the left edge of the toolbar should be otherwise offscreen\n    )}px`;\n  });\n  return __jsx(Portal, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 83,\n      columnNumber: 5\n    }\n  }, __jsx(BasicToolbar, {\n    className: `slate-inline-toolbar ${className}`,\n    ref: ref,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 84,\n      columnNumber: 7\n    }\n  }, children, enableExpando && toggleButton && __jsx(React.Fragment, null, __jsx(Separator, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 88,\n      columnNumber: 13\n    }\n  }), toggleButton)));\n};\n\nexport default Toolbar;","map":{"version":3,"names":["React","useRef","useEffect","Portal","useSlate","Separator","BasicToolbar","Editor","ReactEditor","Toolbar","elementType","enableExpando","toggleButton","className","children","show","ref","editor","el","current","length","removeAttribute","selection","isSidebarOpen","rect","element","nodes","at","getSavedSelection","match","n","type","domEl","toDOMNode","getBoundingClientRect","domSelection","window","getSelection","rangeCount","domRange","getRangeAt","style","opacity","top","pageYOffset","offsetHeight","left","Math","max","pageXOffset","offsetWidth","width"],"sources":["/home/jakob/workspace/training-project/node_modules/@plone/volto/packages/volto-slate/src/editor/ui/Toolbar.jsx"],"sourcesContent":["import React, { useRef, useEffect } from 'react';\nimport { Portal } from 'react-portal';\nimport { useSlate } from 'slate-react';\nimport Separator from './Separator';\nimport BasicToolbar from './BasicToolbar';\nimport { Editor } from 'slate';\nimport { ReactEditor } from 'slate-react';\n\nconst Toolbar = ({\n  elementType,\n  enableExpando = false,\n  toggleButton,\n  className,\n  children,\n  show = true,\n}) => {\n  const ref = useRef();\n  const editor = useSlate();\n\n  useEffect(() => {\n    const el = ref.current;\n\n    if ((children || []).length === 0) {\n      el.removeAttribute('style');\n      return;\n    }\n\n    if (!show) {\n      el.removeAttribute('style');\n      return;\n    }\n\n    const { selection } = editor;\n    // const savedSelection = editor.getSavedSelection();\n    if (!selection) {\n      el.removeAttribute('style');\n      return;\n    }\n\n    if (editor.isSidebarOpen) {\n      el.removeAttribute('style');\n      return;\n    }\n\n    let rect;\n    if (elementType) {\n      const [element] = Editor.nodes(editor, {\n        at: editor.selection || editor.getSavedSelection(),\n        match: (n) => n.type === elementType,\n      });\n\n      if (!element) {\n        el.removeAttribute('style');\n        return;\n      }\n\n      const [n] = element;\n      const domEl = ReactEditor.toDOMNode(editor, n);\n\n      rect = domEl.getBoundingClientRect();\n    } else {\n      const domSelection = window.getSelection();\n      if (domSelection.rangeCount < 1) {\n        // don't do anything here, this happens when opening a focus-stealing\n        // component, in which case we actually want to keep the toolbar open\n        // See\n        // https://stackoverflow.com/questions/22935320/uncaught-indexsizeerror-failed-to-execute-getrangeat-on-selection-0-is-not\n        return;\n      }\n      const domRange = domSelection.getRangeAt(0);\n      rect = domRange.getBoundingClientRect();\n    }\n\n    el.style.opacity = 1;\n    el.style.top = `${rect.top + window.pageYOffset - el.offsetHeight - 6}px`;\n    el.style.left = `${Math.max(\n      rect.left + window.pageXOffset - el.offsetWidth / 2 + rect.width / 2,\n      0, // if the left edge of the toolbar should be otherwise offscreen\n    )}px`;\n  });\n\n  return (\n    <Portal>\n      <BasicToolbar className={`slate-inline-toolbar ${className}`} ref={ref}>\n        {children}\n        {enableExpando && toggleButton && (\n          <>\n            <Separator />\n            {toggleButton}\n          </>\n        )}\n      </BasicToolbar>\n    </Portal>\n  );\n};\n\nexport default Toolbar;\n"],"mappings":"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"},"metadata":{"react-intl":{"messages":[]}},"sourceType":"module"}