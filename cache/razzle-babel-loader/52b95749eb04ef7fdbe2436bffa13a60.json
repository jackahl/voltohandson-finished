{"ast":null,"code":"import _extends from \"/home/jakob/workspace/training-project/node_modules/@babel/runtime/helpers/esm/extends\";\n\nvar _jsxFileName = \"/home/jakob/workspace/training-project/node_modules/@plone/volto/src/components/manage/Blocks/ToC/View.jsx\",\n    _s = $RefreshSig$();\n\nvar __jsx = React.createElement;\n\n/**\n * View toc block.\n * @module components/manage/Blocks/ToC/View\n */\nimport React from 'react';\nimport PropTypes from 'prop-types';\nimport { injectIntl } from 'react-intl';\nimport cx from 'classnames';\nimport { Message } from 'semantic-ui-react';\nimport config from '@plone/volto/registry';\nimport { withBlockExtensions } from '@plone/volto/helpers';\nimport { getBlocksFieldname, getBlocksLayoutFieldname } from '@plone/volto/helpers';\n/**\n * View toc block class.\n * @class View\n * @extends Component\n */\n\nconst View = props => {\n  _s();\n\n  const {\n    properties,\n    data\n  } = props;\n  const {\n    variation\n  } = props;\n  const blocksFieldname = getBlocksFieldname(properties);\n  const blocksLayoutFieldname = getBlocksLayoutFieldname(properties);\n  const levels = React.useMemo(() => {\n    var _data$levels;\n\n    return ((_data$levels = data.levels) === null || _data$levels === void 0 ? void 0 : _data$levels.length) > 0 ? data.levels.map(l => parseInt(l.slice(1))) : [1, 2, 3, 4, 5, 6];\n  }, [data]);\n  const tocEntries = React.useMemo(() => {\n    let rootLevel = Infinity;\n    let entries = [];\n    let prevEntry = {};\n    let tocEntries = {};\n    let tocEntriesLayout = [];\n    properties[blocksLayoutFieldname].items.forEach(id => {\n      var _config$blocks$blocks, _config$blocks$blocks2;\n\n      const block = properties[blocksFieldname][id];\n\n      if (typeof block === 'undefined') {\n        return null;\n      }\n\n      if (!((_config$blocks$blocks = config.blocks.blocksConfig[block['@type']]) !== null && _config$blocks$blocks !== void 0 && _config$blocks$blocks.tocEntry)) return null;\n      const entry = (_config$blocks$blocks2 = config.blocks.blocksConfig[block['@type']]) === null || _config$blocks$blocks2 === void 0 ? void 0 : _config$blocks$blocks2.tocEntry(block, data);\n\n      if (entry) {\n        const level = entry[0];\n        const title = entry[1];\n        const items = [];\n        if (!level || !levels.includes(level)) return;\n        tocEntriesLayout.push(id);\n        tocEntries[id] = {\n          level,\n          title: title || block.plaintext,\n          items,\n          id\n        };\n\n        if (level < rootLevel) {\n          rootLevel = level;\n        }\n      }\n    });\n    tocEntriesLayout.forEach(id => {\n      const entry = tocEntries[id];\n\n      if (entry.level === rootLevel) {\n        entries.push(entry);\n        prevEntry = entry;\n        return;\n      }\n\n      if (!prevEntry.id) return;\n\n      if (entry.level > prevEntry.level) {\n        entry.parentId = prevEntry.id;\n        prevEntry.items.push(entry);\n        prevEntry = entry;\n      } else if (entry.level < prevEntry.level) {\n        let parent = tocEntries[prevEntry.parentId];\n\n        while (entry.level <= parent.level) {\n          parent = tocEntries[parent.parentId];\n        }\n\n        entry.parentId = parent.id;\n        parent.items.push(entry);\n        prevEntry = entry;\n      } else {\n        entry.parentId = prevEntry.parentId;\n        tocEntries[prevEntry.parentId].items.push(entry);\n        prevEntry = entry;\n      }\n    });\n    return entries;\n  }, [data, levels, properties, blocksFieldname, blocksLayoutFieldname]);\n  const Renderer = variation === null || variation === void 0 ? void 0 : variation.view;\n  return __jsx(\"div\", {\n    className: cx('table-of-contents', variation === null || variation === void 0 ? void 0 : variation.id),\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 98,\n      columnNumber: 5\n    }\n  }, props.mode === 'edit' && !data.title && !tocEntries.length && __jsx(Message, {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 100,\n      columnNumber: 9\n    }\n  }, \"Table of content\"), Renderer ? __jsx(Renderer, _extends({}, props, {\n    tocEntries: tocEntries,\n    properties: properties,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 104,\n      columnNumber: 9\n    }\n  })) : __jsx(\"div\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 106,\n      columnNumber: 9\n    }\n  }, \"View extension not found\"));\n};\n/**\n * Property types.\n * @property {Object} propTypes Property types.\n * @static\n */\n\n\n_s(View, \"s5GjHGor2PJ6R0dp/MuxMgYtZ0o=\");\n\n_c = View;\nView.propTypes = {\n  properties: PropTypes.objectOf(PropTypes.any).isRequired\n};\nexport default _c3 = injectIntl(_c2 = withBlockExtensions(View));\n\nvar _c, _c2, _c3;\n\n$RefreshReg$(_c, \"View\");\n$RefreshReg$(_c2, \"%default%$injectIntl\");\n$RefreshReg$(_c3, \"%default%\");","map":{"version":3,"names":["React","PropTypes","injectIntl","cx","Message","config","withBlockExtensions","getBlocksFieldname","getBlocksLayoutFieldname","View","props","properties","data","variation","blocksFieldname","blocksLayoutFieldname","levels","useMemo","length","map","l","parseInt","slice","tocEntries","rootLevel","Infinity","entries","prevEntry","tocEntriesLayout","items","forEach","id","block","blocks","blocksConfig","tocEntry","entry","level","title","includes","push","plaintext","parentId","parent","Renderer","view","mode","propTypes","objectOf","any","isRequired"],"sources":["/home/jakob/workspace/training-project/node_modules/@plone/volto/src/components/manage/Blocks/ToC/View.jsx"],"sourcesContent":["/**\n * View toc block.\n * @module components/manage/Blocks/ToC/View\n */\n\nimport React from 'react';\nimport PropTypes from 'prop-types';\nimport { injectIntl } from 'react-intl';\nimport cx from 'classnames';\nimport { Message } from 'semantic-ui-react';\nimport config from '@plone/volto/registry';\nimport { withBlockExtensions } from '@plone/volto/helpers';\n\nimport {\n  getBlocksFieldname,\n  getBlocksLayoutFieldname,\n} from '@plone/volto/helpers';\n\n/**\n * View toc block class.\n * @class View\n * @extends Component\n */\nconst View = (props) => {\n  const { properties, data } = props;\n  const { variation } = props;\n  const blocksFieldname = getBlocksFieldname(properties);\n  const blocksLayoutFieldname = getBlocksLayoutFieldname(properties);\n  const levels = React.useMemo(\n    () =>\n      data.levels?.length > 0\n        ? data.levels.map((l) => parseInt(l.slice(1)))\n        : [1, 2, 3, 4, 5, 6],\n    [data],\n  );\n  const tocEntries = React.useMemo(() => {\n    let rootLevel = Infinity;\n    let entries = [];\n    let prevEntry = {};\n    let tocEntries = {};\n    let tocEntriesLayout = [];\n\n    properties[blocksLayoutFieldname].items.forEach((id) => {\n      const block = properties[blocksFieldname][id];\n      if (typeof block === 'undefined') {\n        return null;\n      }\n      if (!config.blocks.blocksConfig[block['@type']]?.tocEntry) return null;\n      const entry = config.blocks.blocksConfig[block['@type']]?.tocEntry(\n        block,\n        data,\n      );\n      if (entry) {\n        const level = entry[0];\n        const title = entry[1];\n        const items = [];\n        if (!level || !levels.includes(level)) return;\n        tocEntriesLayout.push(id);\n        tocEntries[id] = { level, title: title || block.plaintext, items, id };\n        if (level < rootLevel) {\n          rootLevel = level;\n        }\n      }\n    });\n\n    tocEntriesLayout.forEach((id) => {\n      const entry = tocEntries[id];\n      if (entry.level === rootLevel) {\n        entries.push(entry);\n        prevEntry = entry;\n        return;\n      }\n      if (!prevEntry.id) return;\n      if (entry.level > prevEntry.level) {\n        entry.parentId = prevEntry.id;\n        prevEntry.items.push(entry);\n        prevEntry = entry;\n      } else if (entry.level < prevEntry.level) {\n        let parent = tocEntries[prevEntry.parentId];\n        while (entry.level <= parent.level) {\n          parent = tocEntries[parent.parentId];\n        }\n        entry.parentId = parent.id;\n        parent.items.push(entry);\n        prevEntry = entry;\n      } else {\n        entry.parentId = prevEntry.parentId;\n        tocEntries[prevEntry.parentId].items.push(entry);\n        prevEntry = entry;\n      }\n    });\n\n    return entries;\n  }, [data, levels, properties, blocksFieldname, blocksLayoutFieldname]);\n\n  const Renderer = variation?.view;\n  return (\n    <div className={cx('table-of-contents', variation?.id)}>\n      {props.mode === 'edit' && !data.title && !tocEntries.length && (\n        <Message>Table of content</Message>\n      )}\n\n      {Renderer ? (\n        <Renderer {...props} tocEntries={tocEntries} properties={properties} />\n      ) : (\n        <div>View extension not found</div>\n      )}\n    </div>\n  );\n};\n\n/**\n * Property types.\n * @property {Object} propTypes Property types.\n * @static\n */\nView.propTypes = {\n  properties: PropTypes.objectOf(PropTypes.any).isRequired,\n};\n\nexport default injectIntl(withBlockExtensions(View));\n"],"mappings":";;;;;;;AAAA;AACA;AACA;AACA;AAEA,OAAOA,KAAP,MAAkB,OAAlB;AACA,OAAOC,SAAP,MAAsB,YAAtB;AACA,SAASC,UAAT,QAA2B,YAA3B;AACA,OAAOC,EAAP,MAAe,YAAf;AACA,SAASC,OAAT,QAAwB,mBAAxB;AACA,OAAOC,MAAP,MAAmB,uBAAnB;AACA,SAASC,mBAAT,QAAoC,sBAApC;AAEA,SACEC,kBADF,EAEEC,wBAFF,QAGO,sBAHP;AAKA;AACA;AACA;AACA;AACA;;AACA,MAAMC,IAAI,GAAIC,KAAD,IAAW;EAAA;;EACtB,MAAM;IAAEC,UAAF;IAAcC;EAAd,IAAuBF,KAA7B;EACA,MAAM;IAAEG;EAAF,IAAgBH,KAAtB;EACA,MAAMI,eAAe,GAAGP,kBAAkB,CAACI,UAAD,CAA1C;EACA,MAAMI,qBAAqB,GAAGP,wBAAwB,CAACG,UAAD,CAAtD;EACA,MAAMK,MAAM,GAAGhB,KAAK,CAACiB,OAAN,CACb;IAAA;;IAAA,OACE,iBAAAL,IAAI,CAACI,MAAL,8DAAaE,MAAb,IAAsB,CAAtB,GACIN,IAAI,CAACI,MAAL,CAAYG,GAAZ,CAAiBC,CAAD,IAAOC,QAAQ,CAACD,CAAC,CAACE,KAAF,CAAQ,CAAR,CAAD,CAA/B,CADJ,GAEI,CAAC,CAAD,EAAI,CAAJ,EAAO,CAAP,EAAU,CAAV,EAAa,CAAb,EAAgB,CAAhB,CAHN;EAAA,CADa,EAKb,CAACV,IAAD,CALa,CAAf;EAOA,MAAMW,UAAU,GAAGvB,KAAK,CAACiB,OAAN,CAAc,MAAM;IACrC,IAAIO,SAAS,GAAGC,QAAhB;IACA,IAAIC,OAAO,GAAG,EAAd;IACA,IAAIC,SAAS,GAAG,EAAhB;IACA,IAAIJ,UAAU,GAAG,EAAjB;IACA,IAAIK,gBAAgB,GAAG,EAAvB;IAEAjB,UAAU,CAACI,qBAAD,CAAV,CAAkCc,KAAlC,CAAwCC,OAAxC,CAAiDC,EAAD,IAAQ;MAAA;;MACtD,MAAMC,KAAK,GAAGrB,UAAU,CAACG,eAAD,CAAV,CAA4BiB,EAA5B,CAAd;;MACA,IAAI,OAAOC,KAAP,KAAiB,WAArB,EAAkC;QAChC,OAAO,IAAP;MACD;;MACD,IAAI,2BAAC3B,MAAM,CAAC4B,MAAP,CAAcC,YAAd,CAA2BF,KAAK,CAAC,OAAD,CAAhC,CAAD,kDAAC,sBAA4CG,QAA7C,CAAJ,EAA2D,OAAO,IAAP;MAC3D,MAAMC,KAAK,6BAAG/B,MAAM,CAAC4B,MAAP,CAAcC,YAAd,CAA2BF,KAAK,CAAC,OAAD,CAAhC,CAAH,2DAAG,uBAA4CG,QAA5C,CACZH,KADY,EAEZpB,IAFY,CAAd;;MAIA,IAAIwB,KAAJ,EAAW;QACT,MAAMC,KAAK,GAAGD,KAAK,CAAC,CAAD,CAAnB;QACA,MAAME,KAAK,GAAGF,KAAK,CAAC,CAAD,CAAnB;QACA,MAAMP,KAAK,GAAG,EAAd;QACA,IAAI,CAACQ,KAAD,IAAU,CAACrB,MAAM,CAACuB,QAAP,CAAgBF,KAAhB,CAAf,EAAuC;QACvCT,gBAAgB,CAACY,IAAjB,CAAsBT,EAAtB;QACAR,UAAU,CAACQ,EAAD,CAAV,GAAiB;UAAEM,KAAF;UAASC,KAAK,EAAEA,KAAK,IAAIN,KAAK,CAACS,SAA/B;UAA0CZ,KAA1C;UAAiDE;QAAjD,CAAjB;;QACA,IAAIM,KAAK,GAAGb,SAAZ,EAAuB;UACrBA,SAAS,GAAGa,KAAZ;QACD;MACF;IACF,CArBD;IAuBAT,gBAAgB,CAACE,OAAjB,CAA0BC,EAAD,IAAQ;MAC/B,MAAMK,KAAK,GAAGb,UAAU,CAACQ,EAAD,CAAxB;;MACA,IAAIK,KAAK,CAACC,KAAN,KAAgBb,SAApB,EAA+B;QAC7BE,OAAO,CAACc,IAAR,CAAaJ,KAAb;QACAT,SAAS,GAAGS,KAAZ;QACA;MACD;;MACD,IAAI,CAACT,SAAS,CAACI,EAAf,EAAmB;;MACnB,IAAIK,KAAK,CAACC,KAAN,GAAcV,SAAS,CAACU,KAA5B,EAAmC;QACjCD,KAAK,CAACM,QAAN,GAAiBf,SAAS,CAACI,EAA3B;QACAJ,SAAS,CAACE,KAAV,CAAgBW,IAAhB,CAAqBJ,KAArB;QACAT,SAAS,GAAGS,KAAZ;MACD,CAJD,MAIO,IAAIA,KAAK,CAACC,KAAN,GAAcV,SAAS,CAACU,KAA5B,EAAmC;QACxC,IAAIM,MAAM,GAAGpB,UAAU,CAACI,SAAS,CAACe,QAAX,CAAvB;;QACA,OAAON,KAAK,CAACC,KAAN,IAAeM,MAAM,CAACN,KAA7B,EAAoC;UAClCM,MAAM,GAAGpB,UAAU,CAACoB,MAAM,CAACD,QAAR,CAAnB;QACD;;QACDN,KAAK,CAACM,QAAN,GAAiBC,MAAM,CAACZ,EAAxB;QACAY,MAAM,CAACd,KAAP,CAAaW,IAAb,CAAkBJ,KAAlB;QACAT,SAAS,GAAGS,KAAZ;MACD,CARM,MAQA;QACLA,KAAK,CAACM,QAAN,GAAiBf,SAAS,CAACe,QAA3B;QACAnB,UAAU,CAACI,SAAS,CAACe,QAAX,CAAV,CAA+Bb,KAA/B,CAAqCW,IAArC,CAA0CJ,KAA1C;QACAT,SAAS,GAAGS,KAAZ;MACD;IACF,CAzBD;IA2BA,OAAOV,OAAP;EACD,CA1DkB,EA0DhB,CAACd,IAAD,EAAOI,MAAP,EAAeL,UAAf,EAA2BG,eAA3B,EAA4CC,qBAA5C,CA1DgB,CAAnB;EA4DA,MAAM6B,QAAQ,GAAG/B,SAAH,aAAGA,SAAH,uBAAGA,SAAS,CAAEgC,IAA5B;EACA,OACE;IAAK,SAAS,EAAE1C,EAAE,CAAC,mBAAD,EAAsBU,SAAtB,aAAsBA,SAAtB,uBAAsBA,SAAS,CAAEkB,EAAjC,CAAlB;IAAA;IAAA;MAAA;MAAA;MAAA;IAAA;EAAA,GACGrB,KAAK,CAACoC,IAAN,KAAe,MAAf,IAAyB,CAAClC,IAAI,CAAC0B,KAA/B,IAAwC,CAACf,UAAU,CAACL,MAApD,IACC,MAAC,OAAD;IAAA;IAAA;MAAA;MAAA;MAAA;IAAA;EAAA,sBAFJ,EAKG0B,QAAQ,GACP,MAAC,QAAD,eAAclC,KAAd;IAAqB,UAAU,EAAEa,UAAjC;IAA6C,UAAU,EAAEZ,UAAzD;IAAA;IAAA;MAAA;MAAA;MAAA;IAAA;EAAA,GADO,GAGP;IAAA;IAAA;MAAA;MAAA;MAAA;IAAA;EAAA,8BARJ,CADF;AAaD,CAtFD;AAwFA;AACA;AACA;AACA;AACA;;;GA5FMF,I;;KAAAA,I;AA6FNA,IAAI,CAACsC,SAAL,GAAiB;EACfpC,UAAU,EAAEV,SAAS,CAAC+C,QAAV,CAAmB/C,SAAS,CAACgD,GAA7B,EAAkCC;AAD/B,CAAjB;AAIA,qBAAehD,UAAU,OAACI,mBAAmB,CAACG,IAAD,CAApB,CAAzB"},"metadata":{"react-intl":{"messages":[]}},"sourceType":"module"}